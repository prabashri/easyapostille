---
import manifest from '../data/assets-manifest.json';
import { inlineCss } from '../data/generated-inline-css.ts';


const isDev = import.meta.env.DEV;

let inlineCssFiles: string[] = [];
let preloadCssFiles: string[] = [];
let nonCriticalCssFiles: string[] = [];

if (isDev) {  
  import.meta.glob([
    '../styles-css/inline/**/*.css',
    '../styles-css/preload/**/*.css',
    '../styles-css/non-critical/**/*.css'
  ], { eager: true });

// Removed invalid import statement; not needed here
  
} else {
  preloadCssFiles = [manifest.css.main.file];            // e.g. /styles/main.abc123.min.css
  nonCriticalCssFiles = [manifest.css.nonCritical.file]; // e.g. /styles/non-critical.xyz456.min.css
}
---
{/* -- ✅ Preload fonts --*/}
<link rel="preload" href="/fonts/Inter-Regular-Subset.woff2" as="font" fetchpriority="high" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/Inter-Bold-Subset.woff2" as="font" fetchpriority="high" type="font/woff2" crossorigin>
{ !isDev && preloadCssFiles[0] && (
  <>
    <link rel="preload" as="style" href={preloadCssFiles[0]} />
  </>
)}

{/* -- ✅ PROD: Inline critical CSS -- */}
{ !isDev && inlineCss && <style id="inline-css" set:html={inlineCss} />}

{/* -- ✅ PROD: Preload + load main CSS -- */}
{ !isDev &&preloadCssFiles[0] && (
  <>
    <link rel="stylesheet" href={preloadCssFiles[0]} fetchpriority="high" />
  </>
)}

{/* -- ✅ PROD: Load non-critical CSS with media="print" + data-swap -- */}
{ !isDev &&nonCriticalCssFiles[0] && (
  <link rel="stylesheet" data-href={nonCriticalCssFiles[0]} data-swap="true" />
)}
