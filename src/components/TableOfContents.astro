---
// src/components/TableOfContents.astro
// <TableOfContents toc={toc} heading="On This Page" depth = 'h2,h3' />
import { Icon } from 'astro-icon/components';
export interface TOCItem {
  id: string;
  text: string;
  level?: number;
}

export interface Props {
  toc: TOCItem[];
  heading?: string;
  depth?: 'h2' | 'h2,h3';
  className?: string;
}


const props = Astro.props;

const {
  toc = [],
  heading = 'On this Page',
  depth = 'h2,h3'
} = props;

const allowedLevels = depth === 'h2' ? [2] : [2, 3];
---

{toc.length > 0 && (
    <aside id="table-of-contents" class={`w-full p-05 ${props.className}`}>
      <details id="toc-details" class="toc-details block lg:[open]" open>
        <summary class="toc-header pointer mb-05 flex jc-space-between ai-center bold no-bullets pb-05">
          <h2 class="text-base bold no-margin">{heading}</h2>      
          <Icon name="down-arrow-2" width="20" height="20" class="arrow-icon" />      
        </summary>
        <nav id="toc-nav" class="toc-nav text-s p-02 overflow-y-auto mx-h-80vh">
            <ul id="toc-list" class="toc-list text-s no-bullets">
                {props.toc
                    .filter(item => item.level !== undefined && allowedLevels.includes(item.level))
                    .map(item => (
                    <li class={item.level === 3 ? 'ml-4' : 'ml-0'}>
                        <a class="block no-bb pi-05 pb-02" href={`#${item.id}`}>{item.text}</a>
                    </li>
                ))}
            </ul>
        </nav>
      </details>
    </aside>
)}



<style id="toc-style">
    details.toc {
      border: none;
      background: none;
    }


details.toc summary::-webkit-details-marker {
  display: none; /* hide default arrow */
}

/* Custom arrow */
.arrow-icon {
  transition: transform 0.3s ease;
  transform: rotate(0deg);
}

/* Rotate when parent <details> is open */
details[open] .arrow-icon {
  transform: rotate(180deg);
}

#toc li.active-heading > a {
  font-weight: bold;
  color: #1d4ed8;
  border-left: 2px solid #1d4ed8;
  background-color: #f0f4ff;
  padding-left: 0.5rem;
}


    /* Highlight active TOC link */
.toc-list a {
  
  border-left: 2px solid transparent;
  transition: border-color 0.2s ease, color 0.2s ease;
}

.toc-list li.active-heading a {
  color: var(--text-active, #111);
  font-weight: 600;
  border-left-color: var(--accent, #4f46e5); /* Indigo or your brand color */
  background-color: var(--highlight-bg, #f0f4ff);
}

</style>
