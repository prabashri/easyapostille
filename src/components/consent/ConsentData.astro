---
// src/components/consent/ConsentData.astro
import { siteFunctions } from '@/config/siteFunctions';

const c = siteFunctions.consent ?? {};

const payload = {
  enabled: !!c.enabled,
  cookieName: c.cookieName ?? "consent.v1",
  ttlDays: c.cookieDuration ?? c.ttlDays ?? 365,     // 1 year default
  autograntMs: c.autograntMs ?? 120000,              // 120s timer
  preConsentPageview: c.preConsentPageview ?? true,  // cookieless PV
  euOnly: c.euOnly ?? true,                          // no autogrant in EU
  version: c.version ?? "1",
  defaults: {
    analytics: c.defaults?.analytics ?? true,
    ads: c.defaults?.ads ?? true,
    personalized: c.defaults?.personalized ?? false
  },
  privacy: {
    urlPassthrough: c.privacy?.urlPassthrough ?? true,
    adsDataRedaction: c.privacy?.adsDataRedaction ?? true,
    developerId: c.privacy?.developerId ?? ""
  },
  policyUrl: c.policyUrl ?? "/privacy-policy/"
};
---

{payload.enabled && (
  <script id="consent-data" type="application/json" set:html={JSON.stringify(payload)} />
)}
