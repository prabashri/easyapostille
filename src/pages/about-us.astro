---
// src/pages/about-us.astro
import BaseLayout from '@/layouts/BaseLayout.astro';
import type { HeadProps } from '@/types/HeadProps';

import { siteDefaults } from '@/config/siteDefaults';
import AboutContent from '@/content/pages/About.astro';

// NEW utils
import { lastModifiedRaw } from '@/utils/last-modified';
import { toMachineDate, toHumanDate, machineAndHuman } from '@/utils/date-format';

// Pull page config (with defaults as safety)
const cfg = siteDefaults.pages.about ?? {
  title: 'About Us',
  description: 'Learn more about us.',
  enabled: true,
  index: true,
  sitemap: true,
  path: '/about-us/',
};

// âœ… SSR redirect if page disabled in config
if (!cfg.enabled) {
  return Astro.redirect('/', 307);
}

// Use configured path for canonical/OG (Astro route remains this file)
const PATH = cfg.path ?? '/about-us/';

// Last modified: try multiple keys; fall back to publishedDate
const rawLastMod = lastModifiedRaw(['about', 'about-us'], siteDefaults.publishedDate);

// For SEO/meta (machine readable) + UI (human readable)
// const updatedAtISO   = toMachineDate(rawLastMod, 'now'); // e.g. "2025-09-12T01:23:45.000Z"
// const updatedAtHuman = toHumanDate(rawLastMod, 'now');   // e.g. "Sep 12, 2025" per site config

const { iso: updatedAtISO, human: updatedAtHuman } = machineAndHuman(rawLastMod, 'now');

// SEO props
const pageSeo: HeadProps = {
  title: cfg.title,
  description: cfg.description,
  image: '',
  type: 'about',
  url: `${siteDefaults.siteUrl}${PATH}`,
  canonicalUrl: `${siteDefaults.siteUrl}${PATH}`,
  siteName: siteDefaults.siteName,
  authors: [],
  publishedAt: siteDefaults.publishedDate,
  updatedAt: updatedAtISO,         // machine/ISO for meta
  index: cfg.index ?? true,
  keywords: [...siteDefaults.keywords, 'About'],
  showBreadcrumb: false,
};
---

<BaseLayout headProps={pageSeo}>
  <Fragment slot="headContent-top" />
  <Fragment slot="headContent-bottom" />

  <AboutContent
    title={pageSeo.title}
    description={pageSeo.description}
    publishedAt={pageSeo.publishedAt}
    updatedAt={updatedAtHuman} 
  />

  <Fragment slot="extraScripts" />
</BaseLayout>
