---
// src/pages/search.astro
import BaseLayout from '@/layouts/BaseLayout.astro';
import type { HeadProps } from '@/types/HeadProps';

import { siteDefaults } from '@/config/siteDefaults';
import SearchContent from '@/content/pages/Search.astro';

const cfg = siteDefaults.pages.search ?? {
  title: 'Search',
  description: `Find articles, guides, and resources.`,
  enabled: true,
  index: false,
  sitemap: false,
  path: '/search/'
};

// SSR redirect if the page is disabled
if (!cfg.enabled) {
  return Astro.redirect('/', 307);
}

// Canonical path (route file stays here)
const PATH = cfg.path ?? '/search/';

// Query from URL
const url = new URL(Astro.request.url);
const q = url.searchParams.get('q')?.toLowerCase() ?? '';

const pageSeo: HeadProps = {
  title: cfg.title,
  description: cfg.description,
  image: '',
  type: 'search',
  url: `${siteDefaults.siteUrl}${PATH}`,
  canonicalUrl: `${siteDefaults.siteUrl}${PATH}`,
  siteName: siteDefaults.siteName,
  authors: [],
  index: cfg.index ?? false,
  keywords: [...siteDefaults.keywords, 'Search'],
  showBreadcrumb: false
};
---

<BaseLayout headProps={pageSeo}>
  <Fragment slot="headContent-top" />
  <Fragment slot="headContent-bottom" />

  <SearchContent
    title={cfg.title}
    description={cfg.description}
    query={q}
    indexPath={siteDefaults.searchIndexPath}
  />

  <Fragment slot="extraScripts" />
</BaseLayout>
