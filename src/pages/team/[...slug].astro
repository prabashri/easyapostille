---
// src/pages/team/[...slug].astro

import { getEntry, render } from 'astro:content';
import TeamLayout from '../../layouts/TeamLayout.astro';
import { init } from 'astro/virtual-modules/prefetch.js';

const { slug } = Astro.params;
const slugId = Array.isArray(slug) ? slug.join('/') : slug;

// Exclude demo/example or invalid slugs
if (!slugId || slugId === '0-example-team') {
  throw Astro.redirect('/404');
}

// Fetch the team entry
const post = await getEntry('team', slugId);
if (!post) {
  throw Astro.redirect('/404');
}

// Render the MDX content
const { Content } = await render(post);

// Normalize fallback values for optional fields
const {
  name,
  prefix = '',
  role,
  highestDegree = '',
  shortBio = '',
  experience,
  expertise = [],
  awards = [],
  affiliation = '',
  addressing = '',
  email,
  website = '',
  color = 'hsl(220, 60%, 70%)',
  joined = '',
  left = '',
  useGravatar = false,
  gravatarEmail = '',
  useImage = false,
  useInitial = false,
  initialText = '',
  image = '',
  social = {},
  featured = false,
} = post.data;

const teamProps = {
  name,
  prefix,
  role,
  highestDegree,
  shortBio,
  experience,
  expertise,
  awards,
  affiliation,
  addressing,
  email,
  website,
  color,
  joined,
  left,
  useGravatar: post.data.useGravatar ?? false,
  gravatarEmail: post.data.gravatarEmail ?? '',
  useImage: post.data.useImage ?? false,
  image: post.data.image ?? '',
  useInitial: post.data.useInitial ?? false,
  initialText: post.data.initialText ?? '',
  social: social ?? {},
  featured,
  slug: post.data.slug ?? slugId,
  id: slugId,
};
---
<TeamLayout {...teamProps}>
  <Content />
</TeamLayout>

