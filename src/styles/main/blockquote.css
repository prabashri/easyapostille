/* ============================
   Elegant blockquote (plain HTML)
   + figure-aware styling
   Requires: /icons/quote.svg
   ============================ */

blockquote {
  /* Theme hooks (uses your existing tokens if present) */
  --bq-accent: var(--primary-base, #1e66f5);
  --bq-border: color-mix(in oklab, var(--bq-accent) 45%, transparent);
  --bq-fill: color-mix(in oklab, var(--bq-accent) 92%, #ffffff);
  --bq-text: CanvasText;

  position: relative;
  margin: 1.25rem 0;
  padding: 1rem 1rem 0.875rem 2.75rem;

  /* Panel look */
  background-color: var(--primary-lighter-x, #f9faff); 
  
  border-top: 4px solid var(--primary-base);
  border-bottom: 1px solid var(--primary-base);
              /* stronger top edge */
  

  color: var(--bq-text);
  
}

/* First/last child spacing */
blockquote > *:first-child { margin-top: 0.25rem; }
blockquote > *:last-child  { margin-bottom: 0.5rem; }

/* Quote icon (tintable with mask) */
blockquote::before {
  content: "";
  position: absolute;
  left: 0; 
  top: 0;
  width: 3rem; 
  height: 3rem;
  display: inline-block;
  background-color: var(--bq-accent);
  opacity: 0.95;
}
@supports ((-webkit-mask: url("")) or (mask: url(""))) {
  blockquote::before {
    -webkit-mask: url("/icons/quote.svg") no-repeat center / contain;
            mask: url("/icons/quote.svg") no-repeat center / contain;
  }
}
@supports not ((-webkit-mask: url("")) or (mask: url(""))) {
  blockquote::before {
    background-image: url("/icons/quote.svg");
    background-repeat: no-repeat;
    background-position: center;
    background-size: contain;
  }
}

/* Links inside the quote */
blockquote a {
  color: var(--bq-accent);
  text-underline-offset: 3px;
  text-decoration-thickness: 1px;
  transition: color .15s ease, text-decoration-color .15s ease;
}
blockquote a:hover {
  color: color-mix(in oklab, var(--bq-accent) 75%, black);
  text-decoration-thickness: 2px;
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  blockquote {
    --bq-fill: color-mix(in oklab, var(--bq-accent) 18%, #000);
    background: color-mix(in oklab, var(--bq-fill) 30%, transparent);
    border-color: color-mix(in oklab, var(--bq-accent) 55%, #000);
  }
}

/* RTL support */
[dir="rtl"] blockquote { padding-left: 1rem; padding-right: 2.75rem; }
[dir="rtl"] blockquote::before { left: auto; right: 0.75rem; }


/* The whole panel lives on <figure> */
figure:has(> blockquote) {
  position: relative;
  margin-block: 1rem;
  padding-bottom: 2rem;
  background-color: var(--primary-lighter-x, #f9faff); 
  
  border-top: 4px solid var(--primary-base);
  border-bottom: 1px solid var(--primary-base);
  color: var(--bq-text);
  line-height: 1.55;
}


/* Blockquote inside the panel: no extra box, just text */
figure:has(> blockquote) > blockquote {
  margin: 0;           /* hug the panel */
  /* padding: 0; */
  border: 0;
  /* background-color: none; */
}

/* Tidy first/last spacing */
figure:has(> blockquote) > blockquote > *:first-child { margin-top: 0.15rem; }
figure:has(> blockquote) > blockquote > *:last-child  { margin-bottom: 0.5rem; }

/* Caption inside the same panel, smaller, blue link */
figure:has(> blockquote) > figcaption {
  padding-left: 3rem;
  font-size: var(--font-size-sm, 0.875rem);
  font-style: italic;
  
}


/* Optional micro-typography in caption */
figure:has(> blockquote) > figcaption .author { font-weight: 600; }
figure:has(> blockquote) > figcaption cite { font-style: italic; }
figure:has(> blockquote) > figcaption .sep { opacity: .7; }

/* Dark mode */
@media (prefers-color-scheme: dark) {
  :root {
    --bq-bg: color-mix(in oklab, var(--bq-accent) 20%, #000);
    --bq-border: color-mix(in oklab, var(--bq-accent) 55%, #000);
  }
}

/* RTL support */
[dir="rtl"] figure:has(> blockquote) { padding-left: 1rem; padding-right: 2.75rem; }
[dir="rtl"] figure:has(> blockquote)::before { left: auto; right: 0.75rem; }

