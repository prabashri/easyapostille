"use strict";let fuseInstance=null,searchData=null;async function loadSearchAssets(){if(fuseInstance)return{fuse:fuseInstance,data:searchData};window.Fuse||await import("/vendor/fuse.min.js?v=7.1.0");try{const t=document.currentScript||[...document.querySelectorAll('script[type="module"]')].find(s=>s.dataset.searchIndex);if(!t)throw new Error("No <script> with data-search-index found.");const a=t.dataset.searchIndex;if(!a)throw new Error("Missing data-search-index attribute.");const c=await fetch(a,{cache:"no-cache"});if(!c.ok)throw new Error(`HTTP ${c.status}`);return searchData=await c.json(),fuseInstance=new Fuse(searchData,{keys:["title","description","content","tags"],threshold:.2,ignoreLocation:!0,includeMatches:!0,minMatchCharLength:2,useExtendedSearch:!0}),{fuse:fuseInstance,data:searchData}}catch(t){return console.error("\u274C Failed to initialize search index:",t),{fuse:null,data:[]}}}function highlightMatch(t,a=[]){const c=document.createDocumentFragment();let s=0;for(const[r,d]of a){r>s&&c.appendChild(document.createTextNode(t.slice(s,r)));const o=document.createElement("mark");o.textContent=t.slice(r,d+1),c.appendChild(o),s=d+1}return s<t.length&&c.appendChild(document.createTextNode(t.slice(s))),c}function createSnippet(t,a){const c=a.toLowerCase(),r=t.toLowerCase().indexOf(c);if(r===-1)return null;const d=t.split(/\s+/);let o=0,E=0;for(let n=0;n<d.length;n++)if(E+=d[n].length+1,E>r){o=n;break}const i=3,u=d.slice(Math.max(0,o-i),o).join(" "),m=d[o]||a,p=d.slice(o+1,o+1+i).join(" "),e=document.createElement("span");e.className="result-snippet",e.textContent=`... ${u} `;const h=document.createElement("mark");return h.textContent=m,e.appendChild(h),e.append(` ${p} ...`),e}function initSearchModal(t){const a=document.getElementById("search-modal"),c=a?.querySelector(".search-modal-content"),s=document.getElementById("search-modal-input"),r=document.getElementById("global-search-button"),d=document.getElementById("close-search-modal"),o=document.getElementById("search-modal-results");if(!a||!s||!o||!r)return;let E=()=>{};function i(e){const h=e.querySelectorAll('a, button, input, textarea, select, [tabindex]:not([tabindex="-1"])'),n=h[0],w=h[h.length-1];function f(l){l.key==="Tab"&&(l.shiftKey&&document.activeElement===n?(l.preventDefault(),w.focus()):!l.shiftKey&&document.activeElement===w&&(l.preventDefault(),n.focus()))}return e.addEventListener("keydown",f),()=>e.removeEventListener("keydown",f)}function u(e){if(o.innerHTML="",!t||e.length<2)return;const h=t.search(e);if(h.length===0){const n=document.createElement("li");n.textContent="No results found",o.appendChild(n);return}for(const{item:n,matches:w}of h.slice(0,10)){const f=document.createElement("li"),l=document.createElement("a");l.href=n.url;const g=Object.fromEntries(w.map(C=>[C.key,C])),y=document.createElement("span");y.className="result-title";const L=g.title?.indices;if(L?.length?y.appendChild(highlightMatch(n.title,L)):y.textContent=n.title,l.appendChild(y),l.appendChild(document.createElement("br")),g.content?.value){const C=createSnippet(n.content,e);C&&l.appendChild(C)}f.appendChild(l),o.appendChild(f)}}async function m(){a.classList.remove("hidden"),a.setAttribute("aria-hidden","false"),s.focus(),E=i(c)}function p(){a.classList.add("hidden"),a.setAttribute("aria-hidden","true"),s.value="",o.innerHTML="",E(),r.focus()}r.addEventListener("click",m),d?.addEventListener("click",p),document.addEventListener("keydown",e=>{e.key==="Escape"&&!a.classList.contains("hidden")&&(e.preventDefault(),p()),(e.metaKey||e.ctrlKey)&&e.key.toLowerCase()==="k"&&(e.preventDefault(),m())}),s.addEventListener("input",()=>{const e=s.value.trim();u(e)})}function initSearchPage(t){const a=document.getElementById("search-input"),c=document.getElementById("search-results");if(!a||!c)return;const r=new URLSearchParams(window.location.search).get("q")||"";let d;function o(i,u){if(c.innerHTML="",!i||i.length===0){c.innerHTML=`<p>No results found for <strong>"${u}"</strong>.</p>`;return}const m=document.createElement("ul");m.className="search-results";for(const{item:p,matches:e}of i.slice(0,20)){const h=document.createElement("li"),n=document.createElement("a");n.href=p.url;const w=Object.fromEntries(e.map(g=>[g.key,g])),f=document.createElement("span");f.className="result-title";const l=w.title?.indices;if(l?.length?f.appendChild(highlightMatch(p.title,l)):f.textContent=p.title,n.appendChild(f),n.appendChild(document.createElement("br")),w.content?.value){const g=createSnippet(p.content||p.description||"",u);g&&n.appendChild(g)}h.appendChild(n),m.appendChild(h)}c.appendChild(m)}function E(i){if(!t||i.length<2){c.innerHTML="";return}const u=t.search(i);o(u,i)}a.addEventListener("input",i=>{const u=i.target.value.trim();clearTimeout(d),d=setTimeout(()=>{E(u);const m=new URL(window.location.href);u?m.searchParams.set("q",u):m.searchParams.delete("q"),window.history.replaceState({},"",m.toString())},250)}),r&&(a.value=r,E(r))}(async()=>{const{fuse:t}=await loadSearchAssets();t&&(initSearchModal(t),initSearchPage(t))})();
