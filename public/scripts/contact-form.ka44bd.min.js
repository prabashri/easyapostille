(() => {
"use strict";(()=>{function B(){const u="contact_form_last_submitted",n=document.getElementById("contact-form"),o=document.getElementById("form-status"),p=document.getElementById("success-box"),d=document.getElementById("subject"),P=document.getElementById("review-fields"),O=document.getElementById("comment-fields");if(!n)return;const a=t=>t?String(t).replace(/<[^>]*>?/gm,"").trim():"",s=(t,e,r=!1)=>{t.textContent=e,t.classList.toggle("error",r),t.classList.remove("display-none")},R={support:"Support",feedback:"Feedback",suggestions:"Suggestions",suggestion:"Suggestions",business:"Business Enquiries",reviews:"Reviews",review:"Reviews",comment:"Comment",comments:"Comment",security:"Security"};d.addEventListener("change",t=>{const e=t.target.value;P.classList.toggle("hidden",e!=="Reviews"),O.classList.toggle("hidden",e!=="Comment")});const g=new URLSearchParams(window.location.search),v=g.get("subject"),w=g.get("post"),b=g.get("title");if(v){const t=v.trim().toLowerCase().replace(/[^a-z]/g,""),e=R[t];e&&(d.value=e,d.dispatchEvent(new Event("change")))}w&&(n.querySelector("[name='postUrl']").value=decodeURIComponent(w)),b&&(n.querySelector("[name='postTitle']").value=decodeURIComponent(b));const S=()=>{const t=localStorage.getItem(u);if(!t)return!1;const r=Date.now()-parseInt(t,10),c=180*1e3-r;if(c>0){const l=Math.floor(c/6e4),i=Math.floor(c%6e4/1e3);return s(p,`\u2705 Message sent! Please wait ${l}:${i.toString().padStart(2,"0")} before sending another.`),n.classList.add("display-none"),setTimeout(S,1e3),!0}else return localStorage.removeItem(u),!1};S()||n.addEventListener("submit",async t=>{var L;t.preventDefault(),s(o,"Sending...",!1);const e=new FormData(n);if(e.get("website")){s(o,"Submission blocked. Please try again later.",!0);return}const r=e.get("token")||e.get("cf-turnstile-response");if(!r){s(o,"\u274C Please complete the CAPTCHA.",!0);return}const c=a(e.get("name")),l=a(e.get("email")),i=a(e.get("subject")),y=a(e.get("message")),T=a(e.get("adminEmail"))||"";if(!c||!l||!i||!y){s(o,"\u274C All required fields must be filled.",!0);return}if(!/^[\w\s.@+-]+$/.test(l)){s(o,"\u274C Invalid email format.",!0);return}const h=e.get("postUrl"),C=e.get("postTitle"),E=e.get("isPublicReview")==="on"||e.get("isPublicComment")==="on",I=i==="Reviews"&&/^[1-5]$/.test(e.get("reviewScore"))?Number(e.get("reviewScore")):null,U=a(e.get("affiliation"))||"";let f=y;i==="Reviews"?f+=`

Review Score: ${I}/5`:i==="Comment"&&(f+=`

Comment on: ${C} (${h||"Unknown"})
Visibility: ${E?"Public":"Private"}`);const q={name:c,email:l,subject:i,message:f,token:r,adminEmail:T,brand:((L=document.querySelector("[name='brand']"))==null?void 0:L.value)||"AstroWEB",reviewScore:I,isPublic:E,affiliation:U,postTitle:C,postUrl:h};try{const m=e.get("handler");if(!m){s(o,"\u274C Service unavailable. Please contact admin directly.",!0);return}(await fetch(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)})).ok?(localStorage.setItem(u,Date.now().toString()),n.reset(),s(p,"\u2705 Message sent successfully!"),n.classList.add("display-none")):s(o,"\u274C Unable to process request at this time.",!0)}catch(m){console.warn("Form submission error:",m),s(o,"\u274C Unable to process request at this time.",!0)}})}document.addEventListener("DOMContentLoaded",B);})();
})();
