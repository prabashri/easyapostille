"use strict";let L=null,v=null;export async function loadSearchAssets(){if(L)return{fuse:L,data:v};window.Fuse||await import("/vendor/fuse.min.js?v=7.1.0");try{const t=document.getElementById("search-index");if(!t)throw new Error("Search index not found in DOM.");const c=JSON.parse(t.textContent||"[]");return v=c,L=new Fuse(c,{keys:["title","description","content","tags"],threshold:.2,ignoreLocation:!0,includeMatches:!0,minMatchCharLength:2,useExtendedSearch:!0}),{fuse:L,data:v}}catch(t){return console.error("\u274C Failed to initialize search index:",t),{fuse:null,data:[]}}}function k(t,c=[]){const o=document.createDocumentFragment();let l=0;for(const[s,d]of c){s>l&&o.appendChild(document.createTextNode(t.slice(l,s)));const a=document.createElement("mark");a.textContent=t.slice(s,d+1),o.appendChild(a),l=d+1}return l<t.length&&o.appendChild(document.createTextNode(t.slice(l))),o}function M(t,c){const o=c.toLowerCase(),s=t.toLowerCase().indexOf(o);if(s===-1)return null;const d=t.split(/\s+/);let a=0,E=0;for(let n=0;n<d.length;n++)if(E+=d[n].length+1,E>s){a=n;break}const r=3,u=d.slice(Math.max(0,a-r),a).join(" "),m=d[a]||c,p=d.slice(a+1,a+1+r).join(" "),e=document.createElement("span");e.className="result-snippet",e.textContent=`... ${u} `;const h=document.createElement("mark");return h.textContent=m,e.appendChild(h),e.append(` ${p} ...`),e}function x(t){const c=document.getElementById("search-modal"),o=c?.querySelector(".search-modal-content"),l=document.getElementById("search-modal-input"),s=document.getElementById("global-search-button"),d=document.getElementById("close-search-modal"),a=document.getElementById("search-modal-results");if(!c||!l||!a||!s)return;let E=()=>{};function r(e){const h=e.querySelectorAll('a, button, input, textarea, select, [tabindex]:not([tabindex="-1"])'),n=h[0],C=h[h.length-1];function f(i){i.key==="Tab"&&(i.shiftKey&&document.activeElement===n?(i.preventDefault(),C.focus()):!i.shiftKey&&document.activeElement===C&&(i.preventDefault(),n.focus()))}return e.addEventListener("keydown",f),()=>e.removeEventListener("keydown",f)}function u(e){if(a.innerHTML="",!t||e.length<2)return;const h=t.search(e);if(h.length===0){const n=document.createElement("li");n.textContent="No results found",a.appendChild(n);return}for(const{item:n,matches:C}of h.slice(0,10)){const f=document.createElement("li"),i=document.createElement("a");i.href=n.url;const g=Object.fromEntries(C.map(w=>[w.key,w])),y=document.createElement("span");y.className="result-title";const b=g.title?.indices;if(b?.length?y.appendChild(k(n.title,b)):y.textContent=n.title,i.appendChild(y),i.appendChild(document.createElement("br")),g.content?.value){const w=M(n.content,e);w&&i.appendChild(w)}f.appendChild(i),a.appendChild(f)}}async function m(){c.classList.remove("hidden"),c.setAttribute("aria-hidden","false"),l.focus(),E=r(o)}function p(){c.classList.add("hidden"),c.setAttribute("aria-hidden","true"),l.value="",a.innerHTML="",E(),s.focus()}s.addEventListener("click",m),d?.addEventListener("click",p),document.addEventListener("keydown",e=>{e.key==="Escape"&&!c.classList.contains("hidden")&&(e.preventDefault(),p()),(e.metaKey||e.ctrlKey)&&e.key.toLowerCase()==="k"&&(e.preventDefault(),m())}),l.addEventListener("input",()=>{const e=l.value.trim();u(e)})}function S(t){const c=document.getElementById("search-input"),o=document.getElementById("search-results");if(!c||!o)return;const s=new URLSearchParams(window.location.search).get("q")||"";let d;function a(r,u){if(o.innerHTML="",!r||r.length===0){o.innerHTML=`<p>No results found for <strong>"${u}"</strong>.</p>`;return}const m=document.createElement("ul");m.className="search-results";for(const{item:p,matches:e}of r.slice(0,20)){const h=document.createElement("li"),n=document.createElement("a");n.href=p.url;const C=Object.fromEntries(e.map(g=>[g.key,g])),f=document.createElement("span");f.className="result-title";const i=C.title?.indices;if(i?.length?f.appendChild(k(p.title,i)):f.textContent=p.title,n.appendChild(f),n.appendChild(document.createElement("br")),C.content?.value){const g=M(p.content||p.description||"",u);g&&n.appendChild(g)}h.appendChild(n),m.appendChild(h)}o.appendChild(m)}function E(r){if(!t||r.length<2){o.innerHTML="";return}const u=t.search(r);a(u,r)}c.addEventListener("input",r=>{const u=r.target.value.trim();clearTimeout(d),d=setTimeout(()=>{E(u);const m=new URL(window.location.href);u?m.searchParams.set("q",u):m.searchParams.delete("q"),window.history.replaceState({},"",m.toString())},250)}),s&&(c.value=s,E(s))}(async()=>{const{fuse:t}=await loadSearchAssets();t&&(x(t),S(t))})();
